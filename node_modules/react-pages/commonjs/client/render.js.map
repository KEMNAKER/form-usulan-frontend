{"version":3,"file":"render.js","names":["render","renderParameters","container","firstRender","renderPage","window","_ReactPages_Page_HotReloadInProgress","then","element","containerProps","rest","renderReactElementTree","React","createElement","getReactContainerElement","result","rerender","to","isServerSidePreloaded","isServerSideRendered","hydrate","firstChild","removeChild","reactRender","getGlobalVariable","name","variable","undefined","document","getElementById","body","Error","setAttribute","appendChild"],"sources":["../../lib/client/render.js"],"sourcesContent":["import React from 'react'\r\n\r\nimport reactRender, { hydrate } from './reactRender.js'\r\n\r\nimport { isServerSidePreloaded, isServerSideRendered } from './flags.js'\r\n\r\n// Performs client-side React application rendering.\r\n// Takes `render()` function which renders the actual page.\r\n// Then this rendered page is rendered in a `container`\r\n// (e.g. Redux state `<Connector/>` and such).\r\n// This function is not exported and is not called directly in an application:\r\n// instead specific implementations call this function\r\n// providing their own `render()` logic\r\n// (e.g. Redux + React-router, React-router).\r\n//\r\nexport default function render({ render, renderParameters = {}, container }) {\r\n\tlet firstRender = true\r\n\t// Renders current React page (inside a container).\r\n\t// Returns a Promise for an object holding\r\n\t// `render` function for development mode hot reload,\r\n\t// and also `store` (if Redux is used).\r\n\tfunction renderPage() {\r\n\t\tif (firstRender) {\r\n\t\t\tfirstRender = false\r\n\t\t} else {\r\n\t\t\twindow._ReactPages_Page_HotReloadInProgress = true\r\n\t\t}\r\n\t\treturn render(renderParameters).then(({ element, containerProps, ...rest }) => {\r\n\t\t\t// if (locale) {\r\n\t\t\t// \tcontainerProps.locale = locale\r\n\t\t\t// }\r\n\t\t\trenderReactElementTree(\r\n\t\t\t\t// Render page `element` inside a container element.\r\n\t\t\t\t// E.g. Redux context `<Provider/>`, and others.\r\n\t\t\t\tReact.createElement(container, containerProps, element),\r\n\t\t\t\t// DOM element to which React markup will be rendered\r\n\t\t\t\tgetReactContainerElement()\r\n\t\t\t)\r\n\t\t\twindow._ReactPages_Page_HotReloadInProgress = false\r\n\t\t\treturn rest\r\n\t\t})\r\n\t}\r\n\t// Render the page on the client side.\r\n\treturn renderPage().then((result) => ({\r\n\t\t// Redux `store`, for example.\r\n\t\t...result,\r\n\t\t// Deprecated. Don't use.\r\n\t\trerender: renderPage\r\n\t}))\r\n}\r\n\r\nfunction renderReactElementTree(element, to) {\r\n\t// If using React >= 16 and the content is Server-Side Rendered.\r\n\tif (isServerSidePreloaded() && isServerSideRendered()) {\r\n\t\t// An API introduced in React 16\r\n\t\t// for \"hydrating\" Server-Side Rendered markup.\r\n\t\t// https://reactjs.org/docs/react-dom.html#hydrate\r\n\t\thydrate(element, to)\r\n\t\treturn\r\n\t}\r\n\t// Clears `element` to prevent React warning:\r\n\t// \"Calling ReactDOM.render() to hydrate server-rendered markup\r\n\t//  will stop working in React v17. Replace the ReactDOM.render() call\r\n\t//  with ReactDOM.hydrate() if you want React to attach to the server HTML.\"\r\n\tif (!window._ReactPages_Page_HotReloadInProgress) {\r\n\t\twhile (to.firstChild) {\r\n\t\t\tto.removeChild(to.firstChild)\r\n\t\t}\r\n\t}\r\n\treactRender(element, to)\r\n}\r\n\r\n// Retrieves a variable from `window` erasing it.\r\nfunction getGlobalVariable(name) {\r\n\tconst variable = window[name]\r\n\tif (variable !== undefined) {\r\n\t\tdelete window[name]\r\n\t}\r\n\treturn variable\r\n}\r\n\r\nfunction getReactContainerElement()\r\n{\r\n\tlet element = document.getElementById('react')\r\n\r\n\tif (!element) {\r\n\t\tconst body = document.body\r\n\t\tif (!body) {\r\n\t\t\tthrow new Error('<body/> tag not found, make sure this script is added to the end of <body/> rather than inside <head/>.')\r\n\t\t}\r\n\t\telement = document.createElement('div')\r\n\t\telement.setAttribute('id', 'react')\r\n\t\tbody.appendChild(element)\r\n\t}\r\n\r\n\treturn element\r\n}"],"mappings":";;;;;;;AAAA;AAEA;AAEA;AAAwE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAExE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,MAAM,OAA+C;EAAA,IAA5CA,MAAM,QAANA,MAAM;IAAA,6BAAEC,gBAAgB;IAAhBA,gBAAgB,sCAAG,CAAC,CAAC;IAAEC,SAAS,QAATA,SAAS;EACxE,IAAIC,WAAW,GAAG,IAAI;EACtB;EACA;EACA;EACA;EACA,SAASC,UAAU,GAAG;IACrB,IAAID,WAAW,EAAE;MAChBA,WAAW,GAAG,KAAK;IACpB,CAAC,MAAM;MACNE,MAAM,CAACC,oCAAoC,GAAG,IAAI;IACnD;IACA,OAAON,MAAM,CAACC,gBAAgB,CAAC,CAACM,IAAI,CAAC,iBAA0C;MAAA,IAAvCC,OAAO,SAAPA,OAAO;QAAEC,cAAc,SAAdA,cAAc;QAAKC,IAAI;MACvE;MACA;MACA;MACAC,sBAAsB;MACrB;MACA;MACAC,iBAAK,CAACC,aAAa,CAACX,SAAS,EAAEO,cAAc,EAAED,OAAO,CAAC;MACvD;MACAM,wBAAwB,EAAE,CAC1B;MACDT,MAAM,CAACC,oCAAoC,GAAG,KAAK;MACnD,OAAOI,IAAI;IACZ,CAAC,CAAC;EACH;EACA;EACA,OAAON,UAAU,EAAE,CAACG,IAAI,CAAC,UAACQ,MAAM;IAAA,uCAE5BA,MAAM;MACT;MACAC,QAAQ,EAAEZ;IAAU;EAAA,CACnB,CAAC;AACJ;AAEA,SAASO,sBAAsB,CAACH,OAAO,EAAES,EAAE,EAAE;EAC5C;EACA,IAAI,IAAAC,4BAAqB,GAAE,IAAI,IAAAC,2BAAoB,GAAE,EAAE;IACtD;IACA;IACA;IACA,IAAAC,oBAAO,EAACZ,OAAO,EAAES,EAAE,CAAC;IACpB;EACD;EACA;EACA;EACA;EACA;EACA,IAAI,CAACZ,MAAM,CAACC,oCAAoC,EAAE;IACjD,OAAOW,EAAE,CAACI,UAAU,EAAE;MACrBJ,EAAE,CAACK,WAAW,CAACL,EAAE,CAACI,UAAU,CAAC;IAC9B;EACD;EACA,IAAAE,uBAAW,EAACf,OAAO,EAAES,EAAE,CAAC;AACzB;;AAEA;AACA,SAASO,iBAAiB,CAACC,IAAI,EAAE;EAChC,IAAMC,QAAQ,GAAGrB,MAAM,CAACoB,IAAI,CAAC;EAC7B,IAAIC,QAAQ,KAAKC,SAAS,EAAE;IAC3B,OAAOtB,MAAM,CAACoB,IAAI,CAAC;EACpB;EACA,OAAOC,QAAQ;AAChB;AAEA,SAASZ,wBAAwB,GACjC;EACC,IAAIN,OAAO,GAAGoB,QAAQ,CAACC,cAAc,CAAC,OAAO,CAAC;EAE9C,IAAI,CAACrB,OAAO,EAAE;IACb,IAAMsB,IAAI,GAAGF,QAAQ,CAACE,IAAI;IAC1B,IAAI,CAACA,IAAI,EAAE;MACV,MAAM,IAAIC,KAAK,CAAC,yGAAyG,CAAC;IAC3H;IACAvB,OAAO,GAAGoB,QAAQ,CAACf,aAAa,CAAC,KAAK,CAAC;IACvCL,OAAO,CAACwB,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC;IACnCF,IAAI,CAACG,WAAW,CAACzB,OAAO,CAAC;EAC1B;EAEA,OAAOA,OAAO;AACf"}