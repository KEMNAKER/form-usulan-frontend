{"version":3,"file":"index.js","names":["createRouterStoreEnhancers","routes","createHistoryProtocol","options","middlewares","queryMiddleware","basename","push","createBasenameMiddleware","createHistoryEnhancer","protocol","createMatchEnhancer","Matcher","matchRoutes","store","getStoreRenderArgs","resolver","matchContext","dispatch","getState","then","renderArgs","error","getRoutesByPath","routeIndices","matchedRoutes","i","children","getMatchedRoutes","state","found","match","getMatchedRoutesIndices","getMatchedRoutesParams","routeParams","getRouteParams","params","getCurrentlyMatchedLocation","location","getPreviouslyMatchedLocation","resolvedMatch","getRoutePath","filter","route","path","map","replace","join","convertRoutes","makeRouteConfig","initializeRouter","Actions","init","redirect","goto","markImmediateNavigationAsInstantBack","instantBack","REDIRECT_ACTION_TYPE","ActionTypes","REPLACE","GOTO_ACTION_TYPE","PUSH","goBack","go","goBackTwoPages","goForward","pushLocation","window","_ReactPages_Page_SkipDataLoad_on_navigation","replaceLocation","UPDATE_MATCH","FoundActionTypes","RESOLVE_MATCH","_RESOLVE_MATCH"],"sources":["../../lib/router/index.js"],"sourcesContent":["export {\r\n\tfoundReducer,\r\n\tRoute,\r\n\tRedirect,\r\n\tuseRouter,\r\n\tRedirectException\r\n} from '@catamphetamine/found'\r\n\r\nimport {\r\n\tcreateMatchEnhancer,\r\n\tMatcher,\r\n\tmakeRouteConfig,\r\n\tgetStoreRenderArgs,\r\n\tHttpError,\r\n\tresolver,\r\n\tActionTypes as FoundActionTypes\r\n} from '@catamphetamine/found'\r\n\r\nimport {\r\n\tActions,\r\n\tActionTypes,\r\n\tcreateHistoryEnhancer,\r\n\tcreateBasenameMiddleware,\r\n\tqueryMiddleware\r\n} from 'farce'\r\n\r\nimport { markImmediateNavigationAsInstantBack } from '../redux/client/instantNavigation.js'\r\n\r\nexport function createRouterStoreEnhancers(routes, createHistoryProtocol, options = {}) {\r\n\tconst middlewares = [\r\n\t\tqueryMiddleware\r\n\t]\r\n\tif (options.basename) {\r\n\t\tmiddlewares.push(createBasenameMiddleware({\r\n\t\t\tbasename: options.basename\r\n\t\t}))\r\n\t}\r\n\treturn [\r\n\t\tcreateHistoryEnhancer({\r\n\t\t\tprotocol: createHistoryProtocol(),\r\n\t\t\tmiddlewares\r\n\t\t}),\r\n\t\tcreateMatchEnhancer(\r\n\t\t\t// new Matcher(hotRouteConfig(routes))\r\n\t\t\tnew Matcher(routes)\r\n\t\t)\r\n\t]\r\n}\r\n\r\nexport function matchRoutes(store) {\r\n\treturn getStoreRenderArgs({\r\n\t\tstore,\r\n\t\tresolver,\r\n\t\tmatchContext: {\r\n\t\t\tdispatch: store.dispatch,\r\n\t\t\tgetState: store.getState\r\n\t\t}\r\n\t})\r\n\t.then((renderArgs) => {\r\n\t\tif (renderArgs.error) {\r\n\t\t\tthrow renderArgs.error\r\n\t\t}\r\n\t\treturn renderArgs\r\n\t})\r\n}\r\n\r\nexport function getRoutesByPath(routeIndices, routes) {\r\n\tconst matchedRoutes = []\r\n\tfor (const i of routeIndices) {\r\n\t\tmatchedRoutes.push(routes[i])\r\n\t\troutes = routes[i].children\r\n\t}\r\n\treturn matchedRoutes\r\n}\r\n\r\nexport function getMatchedRoutes(state, routes) {\r\n\treturn getRoutesByPath(state.found.match.routeIndices, routes)\r\n}\r\n\r\nexport function getMatchedRoutesIndices(state) {\r\n\treturn state.found.match.routeIndices\r\n}\r\n\r\n// A URL can consist of several \"routes\": a parent route + possible sub-routes.\r\n// \"Matched route params\" are just this particular route's params for a given URL.\r\n// All routes' params are the combined params for all matched routes for a given URL.\r\n//\r\n// Example:\r\n//\r\n// const routes = [{\r\n//   path: ':foo',\r\n//   children: [{\r\n//     path: ':bar'\r\n//   }]\r\n// }]\r\n//\r\n// const location = {\r\n//   pathname: '/a/b'\r\n// }\r\n//\r\n// const routeParams = [\r\n// \t{ foo: 'a' },\r\n// \t{ bar: 'b' }\r\n// ]\r\n//\r\n// const params = {\r\n//   foo: 'a',\r\n//   bar: 'b'\r\n// }\r\n//\r\nexport function getMatchedRoutesParams(state) {\r\n\treturn state.found.match.routeParams\r\n}\r\n\r\nexport function getRouteParams(state) {\r\n\tconst routeIndices = getMatchedRoutesIndices(state)\r\n\treturn state.found.match.params\r\n}\r\n\r\nexport function getCurrentlyMatchedLocation(state) {\r\n\treturn state.found.match.location\r\n}\r\n\r\nexport function getPreviouslyMatchedLocation(state) {\r\n\treturn state.found.resolvedMatch &&\r\n\t\t// state.found.resolvedMatch.location.key === undefined &&\r\n\t\tstate.found.resolvedMatch.location\r\n}\r\n\r\n// Returns a complete route path for matched routes chain.\r\n// E.g. returns \"/user/:user_id/post/:post_id\"\r\n// for matched URL \"/user/1/post/123?key=value\".\r\nexport function getRoutePath(routes)\r\n{\r\n\treturn routes\r\n\t\t// Select routes having `path` React property set.\r\n\t\t.filter(route => route.path)\r\n\t\t// Trim leading and trailing slashes (`/`)\r\n\t\t// from each route `path` React property.\r\n\t\t.map(route => route.path.replace(/^\\//, '').replace(/\\/$/, ''))\r\n\t\t// Join route `path`s with slashes (`/`).\r\n\t\t.join('/') || '/'\r\n}\r\n\r\nexport function convertRoutes(routes) {\r\n\treturn makeRouteConfig(routes)\r\n}\r\n\r\nexport function initializeRouter(store) {\r\n\tstore.dispatch(Actions.init())\r\n}\r\n\r\nexport const redirect = Actions.replace\r\n\r\nexport const goto = (location, options = {}) => {\r\n\tmarkImmediateNavigationAsInstantBack(options.instantBack)\r\n\treturn Actions.push(location)\r\n}\r\n\r\nexport const REDIRECT_ACTION_TYPE = ActionTypes.REPLACE\r\nexport const GOTO_ACTION_TYPE = ActionTypes.PUSH\r\n\r\nexport function goBack() {\r\n\treturn Actions.go(-1)\r\n}\r\n\r\nexport function goBackTwoPages() {\r\n\treturn Actions.go(-2)\r\n}\r\n\r\nexport function goForward() {\r\n\treturn Actions.go(1)\r\n}\r\n\r\nexport function pushLocation(location, options) {\r\n\twindow._ReactPages_Page_SkipDataLoad_on_navigation = true\r\n\treturn goto(location, options)\r\n}\r\n\r\nexport function replaceLocation(location) {\r\n\twindow._ReactPages_Page_SkipDataLoad_on_navigation = true\r\n\treturn redirect(location)\r\n}\r\n\r\nexport const UPDATE_MATCH = FoundActionTypes.UPDATE_MATCH\r\nexport const RESOLVE_MATCH = FoundActionTypes.RESOLVE_MATCH\r\n\r\nexport const _RESOLVE_MATCH = '@@react-pages/RESOLVE_MATCH'"],"mappings":"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"}