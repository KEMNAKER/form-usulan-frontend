{"version":3,"file":"store.js","names":["_createStore","settings","data","createHistoryProtocol","httpClient","options","reducers","reduxMiddleware","reduxStoreEnhancers","reduxEventNaming","http","onError","getLocale","codeSplit","meta","showLoadingInitially","routes","server","devtools","stats","onBeforeNavigate","onNavigate","getCookie","convertedRoutes","getConvertedRoutes","getData","createGetDataForPreload","Array","isArray","React","cloneElement","convertRoutes","middleware","push","asynchronousMiddleware","getErrorData","routerMiddleware","storeEnhancers","createRouterStoreEnhancers","basename","applyMiddleware","store","getStoreEnhancersComposer","createStore","createReducer","hotReload","replaceReducer","initializeRouter","RESERVED_REDUCER_NAMES","reducerName","Error","checkForAutogeneratedEventNameCollision","found","foundReducer","preload","preloadReducer","combineReducers","compose","composeWithDevTools"],"sources":["../../lib/redux/store.js"],"sourcesContent":["import React from 'react'\r\nimport { createStore, combineReducers, applyMiddleware, compose } from 'redux'\r\nimport { composeWithDevTools } from 'redux-devtools-extension/logOnlyInProduction.js'\r\n\r\nimport asynchronousMiddleware from './middleware/asynchronous.js'\r\nimport routerMiddleware from './middleware/router.js'\r\n\r\nimport preloadReducer from './preload/reducer.js'\r\nimport createGetDataForPreload from './preload/getData.js'\r\n\r\nimport translateReducer from './translate/reducer.js'\r\n\r\nimport { checkForAutogeneratedEventNameCollision } from './naming.js'\r\n\r\nimport {\r\n\tconvertRoutes,\r\n\tfoundReducer,\r\n\tcreateRouterStoreEnhancers,\r\n\tinitializeRouter\r\n} from '../router/index.js'\r\n\r\nexport default function _createStore(settings, data, createHistoryProtocol, httpClient, options)\r\n{\r\n\tconst {\r\n\t\treducers,\r\n\t\treduxMiddleware,\r\n\t\treduxStoreEnhancers,\r\n\t\treduxEventNaming,\r\n\t\thttp,\r\n\t\tonError,\r\n\t\tgetLocale,\r\n\t\tcodeSplit,\r\n\t\tmeta,\r\n\t\tshowLoadingInitially\r\n\t} = settings\r\n\r\n\tlet {\r\n\t\troutes\r\n\t} = settings\r\n\r\n\tconst {\r\n\t\tserver,\r\n\t\tdevtools,\r\n\t\tstats,\r\n\t\tonBeforeNavigate,\r\n\t\tonNavigate,\r\n\t\tgetCookie\r\n\t} = options\r\n\r\n\t// `routes` will be converted.\r\n\tlet convertedRoutes\r\n\tconst getConvertedRoutes = () => convertedRoutes\r\n\r\n\t// Add `load` data hook.\r\n\tconst getData = createGetDataForPreload(codeSplit, server, onError, getLocale, getConvertedRoutes, getCookie)\r\n\tif (Array.isArray(routes)) {\r\n\t\t// If there's an error on client side in `setUpAndRender()` then it's called again.\r\n\t\t// And in that case `getData` is set and this error will be thrown.\r\n\t\t// if (routes[0].getData) {\r\n\t\t// \tthrow new Error('[react-pages] `getData` found on the root route')\r\n\t\t// }\r\n\t\troutes[0].getData = getData\r\n\t} else {\r\n\t\t// Set `getData`.\r\n\t\t// If there's an error on client side in `setUpAndRender()` then it's called again.\r\n\t\t// And in that case `getData` is set and this error will be thrown.\r\n\t\t// if (routes.props.getData) {\r\n\t\t// \tthrow new Error('[react-pages] `getData` found on the root route')\r\n\t\t// }\r\n\t\troutes = React.cloneElement(routes, { getData })\r\n\t\t// Convert `found` `<Route/>`s to a JSON structure.\r\n\t\troutes = convertRoutes(routes)\r\n\t}\r\n\tconvertedRoutes = routes\r\n\r\n\t// Redux middleware.\r\n\t// User may supply his own Redux middleware.\r\n\tconst middleware = reduxMiddleware ? reduxMiddleware() : []\r\n\r\n\t// Built-in middleware.\r\n\tmiddleware.push(\r\n\t\t// Asynchronous middleware (e.g. for HTTP Ajax calls).\r\n\t\tasynchronousMiddleware(\r\n\t\t\thttpClient,\r\n\t\t\treduxEventNaming,\r\n\t\t\tserver,\r\n\t\t\thttp.onError,\r\n\t\t\thttp.getErrorData\r\n\t\t)\r\n\t)\r\n\r\n\tif (!server) {\r\n\t\tmiddleware.push(routerMiddleware(\r\n\t\t\troutes,\r\n\t\t\tcodeSplit,\r\n\t\t\tonBeforeNavigate,\r\n\t\t\tonNavigate,\r\n\t\t\tstats,\r\n\t\t\tmeta\r\n\t\t))\r\n\t}\r\n\r\n\t// Redux \"store enhancers\"\r\n\tconst storeEnhancers = []\r\n\r\n\t// User may supply his own Redux store enhancers.\r\n\tif (reduxStoreEnhancers) {\r\n\t\tstoreEnhancers.push(...reduxStoreEnhancers())\r\n\t}\r\n\r\n\tstoreEnhancers.push(...createRouterStoreEnhancers(routes, createHistoryProtocol, {\r\n\t\tbasename: settings.basename\r\n\t}))\r\n\r\n\t// Redux middleware are applied in reverse order.\r\n\t// (which is counter-intuitive)\r\n\tstoreEnhancers.push(applyMiddleware(...middleware))\r\n\r\n\t// Create Redux store.\r\n\tconst store = getStoreEnhancersComposer(server, devtools)(...storeEnhancers)(createStore)(createReducer(reducers, showLoadingInitially), data)\r\n\r\n\t// On the client side, add `hotReload()` function to the `store`.\r\n\t// (could just add this function to `window` but adding it to the `store` fits more)\r\n\tif (!server) {\r\n\t\t// `hotReload` helper function gives the web application means to hot reload its Redux reducers\r\n\t\tstore.hotReload = (reducers) => store.replaceReducer(createReducer(reducers, showLoadingInitially))\r\n\t}\r\n\r\n\t// Initialize `found`.\r\n\tinitializeRouter(store)\r\n\r\n\t// Return the Redux store\r\n\treturn store\r\n}\r\n\r\nfunction createReducer(reducers, showLoadingInitially)\r\n{\r\n\t// Check for reserved reducer names.\r\n\tfor (const reducerName of RESERVED_REDUCER_NAMES) {\r\n\t\tif (reducers[reducerName]) {\r\n\t\t\tthrow new Error(`\"${reducerName}\" reducer name is reserved.`)\r\n\t\t}\r\n\t}\r\n\t// Check for `ReduxModule` autogenerated event names conflicts.\r\n\tcheckForAutogeneratedEventNameCollision(reducers)\r\n\t// Clone the object because it will be modified.\r\n\treducers = { ...reducers }\r\n\t// Add `found` reducer.\r\n\treducers.found = foundReducer\r\n\t// Add `load` status reducer.\r\n\treducers.preload = preloadReducer(showLoadingInitially)\r\n\t// // Add `@translate()` reducer.\r\n\t// reducers.translation = translateReducer\r\n\t// Create the compound reducer.\r\n\treturn combineReducers(reducers)\r\n}\r\n\r\nfunction getStoreEnhancersComposer(server, devtools)\r\n{\r\n\t// Redux DevTools aren't used on the server side\r\n\tif (server) {\r\n\t\treturn compose\r\n\t}\r\n\r\n\t// Custom behaviour\r\n\tif (devtools && devtools.compose) {\r\n\t\treturn devtools.compose\r\n\t}\r\n\r\n\t// With custom options\r\n\tif (devtools && devtools.options) {\r\n\t\treturn composeWithDevTools(devtools.options)\r\n\t}\r\n\r\n\t// Without custom options\r\n\treturn composeWithDevTools\r\n}\r\n\r\nconst RESERVED_REDUCER_NAMES = [\r\n\t'found',\r\n\t'location',\r\n\t'preload',\r\n\t'translation'\r\n]"],"mappings":"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"}