{"version":3,"file":"router.js","names":["ON_PAGE_LOADED_METHOD_NAME","routerMiddleware","routes","codeSplit","onBeforeNavigate","onNavigate","reportStats","defaultMeta","startedAt","previousLocation","previousRouteIndices","dispatch","getState","next","event","window","_ReactPages_Page_ServerSideRenderedPageRestorationPrerender","location","payload","routeIndices","type","UPDATE_MATCH","shouldSkipPreloadForNavigation","_ReactPages_RouterHasFinishedInitialRender","isServerSidePreloaded","_ReactPages_SimulatedResolveMatchEventPayload","Date","now","_isInstantTransition","action","isInstantTransition","setInstantNavigationFlag","instantBack","_ReactPages_Page_IsInstantBackNavigation","addInstantBack","updateInstantNavigationChainIndex","resetInstantNavigationChain","_ReactPages_Page_NavigationIsInstantBack","_ReactPages_Navigation_Start_Listeners","navigationStartListener","params","PRELOAD_STARTED","RESOLVE_MATCH","_RESOLVE_MATCH","_ReactPages_Navigation_IgnoreResolveMatchEvent","undefined","Error","pathname","routeChain","getRoutesByPath","pageRoute","length","onPageLoaded","Component","updateMetaTags","getDefaultMeta","getLocationUrl","_ReactPages_Navigation_End_Listeners","navigationEndListener","url","route","getRoutePath","time","loadAndRender","PRELOAD_FINISHED","console","log","state","meta","getCodeSplitMeta","getComponentsMeta","map","_","mergeMeta","updateMeta"],"sources":["../../../lib/redux/middleware/router.js"],"sourcesContent":["import { UPDATE_MATCH, RESOLVE_MATCH, _RESOLVE_MATCH, getRoutesByPath, getRoutePath } from '../../router/index.js'\r\nimport { getComponentsMeta, mergeMeta, updateMeta, getCodeSplitMeta } from '../../meta/meta.js'\r\nimport getLocationUrl from '../../getLocationUrl.js'\r\nimport shouldSkipPreloadForNavigation from '../preload/shouldSkipPreloadForNavigation.js'\r\n\r\nimport {\r\n\tPRELOAD_STARTED,\r\n\tPRELOAD_FINISHED,\r\n\tPRELOAD_FAILED\r\n} from '../preload/actions.js'\r\n\r\nimport {\r\n\tisInstantTransition,\r\n\tsetInstantNavigationFlag,\r\n\taddInstantBack,\r\n\tupdateInstantNavigationChainIndex,\r\n\tresetInstantNavigationChain\r\n} from '../client/instantNavigation.js'\r\n\r\nimport { isServerSidePreloaded } from '../../client/flags.js'\r\n\r\nimport getDefaultMeta from '../../meta/getDefaultMeta.js'\r\n\r\nconst ON_PAGE_LOADED_METHOD_NAME = 'onLoaded'\r\n\r\n// Any events listened to here are being dispatched on client side.\r\nexport default function routerMiddleware(\r\n\troutes,\r\n\tcodeSplit,\r\n\tonBeforeNavigate,\r\n\tonNavigate,\r\n\treportStats,\r\n\tdefaultMeta\r\n) {\r\n\tlet startedAt\r\n\tlet previousLocation\r\n\tlet previousRouteIndices\r\n\r\n\treturn ({ dispatch, getState }) =>\r\n\t{\r\n\t\treturn next => event =>\r\n\t\t{\r\n\t\t\t// Skip the first pass of the initial client-side render.\r\n\t\t\t// for the case when server-side rendering is used.\r\n\t\t\tif (window._ReactPages_Page_ServerSideRenderedPageRestorationPrerender) {\r\n\t\t\t\treturn next(event)\r\n\t\t\t}\r\n\r\n\t\t\tconst location = event.payload && event.payload.location\r\n\t\t\tconst routeIndices = event.payload && event.payload.routeIndices\r\n\r\n\t\t\tswitch (event.type) {\r\n\t\t\t\t// `UPDATE_MATCH` event is triggered when navigation starts.\r\n\t\t\t\t// `RESOLVE_MATCH` event is triggered when navigation ends.\r\n\t\t\t\t//\r\n\t\t\t\tcase UPDATE_MATCH:\r\n\t\t\t\t\t// A workaround for `found` router bug:\r\n\t\t\t\t\t// https://github.com/4Catalyzer/found/issues/239\r\n\t\t\t\t\t// Skip `load` and other stuff for anchor link navigation.\r\n\t\t\t\t\tif (previousLocation && shouldSkipPreloadForNavigation(previousLocation, location)) {\r\n\t\t\t\t\t\t// I guess this workaround won't work with `codeSplit: true`\r\n\t\t\t\t\t\t// because `codeSplit` doesn't use the global `getData` loader.\r\n\t\t\t\t\t\tif (!codeSplit) {\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Store `event.payload` for the future `_UPDATE_MATCH` event.\r\n\t\t\t\t\tif (!window._ReactPages_RouterHasFinishedInitialRender && !isServerSidePreloaded()) {\r\n\t\t\t\t\t\twindow._ReactPages_SimulatedResolveMatchEventPayload = event.payload\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Measure `load` and `render` time.\r\n\t\t\t\t\tstartedAt = Date.now()\r\n\r\n\t\t\t\t\t// If it's an instant \"Back\"/\"Forward\" navigation\r\n\t\t\t\t\t// then navigate to the page without loading it.\r\n\t\t\t\t\t// (has been previously preloaded and is in Redux state)\r\n\t\t\t\t\tconst _isInstantTransition =\r\n\t\t\t\t\t\tlocation.action === 'POP' &&\r\n\t\t\t\t\t\tpreviousLocation &&\r\n\t\t\t\t\t\tisInstantTransition(previousLocation, location)\r\n\r\n\t\t\t\t\t// Set the flag for `wasInstantNavigation()`.\r\n\t\t\t\t\tsetInstantNavigationFlag(_isInstantTransition)\r\n\r\n\t\t\t\t\t// Indicates whether an `instantBack` `<Link/>` has been clicked.\r\n\t\t\t\t\t// (or if `goto()` has been called with `instantBack: true` option)\r\n\t\t\t\t\tconst instantBack = window._ReactPages_Page_IsInstantBackNavigation\r\n\r\n\t\t\t\t\t// Update instant back navigation chain.\r\n\t\t\t\t\tif (instantBack) {\r\n\t\t\t\t\t\t// Stores \"current\" (soon to be \"previous\") location\r\n\t\t\t\t\t\t// in \"instant back chain\", so that if \"Back\" is clicked\r\n\t\t\t\t\t\t// then such transition could be detected as \"should be instant\".\r\n\t\t\t\t\t\taddInstantBack(\r\n\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t\tpreviousLocation,\r\n\t\t\t\t\t\t\trouteIndices,\r\n\t\t\t\t\t\t\tpreviousRouteIndices\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t} else if (_isInstantTransition) {\r\n\t\t\t\t\t\tupdateInstantNavigationChainIndex(location)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// If current transition is not \"instant back\" and not \"instant\"\r\n\t\t\t\t\t\t// then reset the whole \"instant back\" chain.\r\n\t\t\t\t\t\t// Only a consequitive \"instant back\" navigation chain\r\n\t\t\t\t\t\t// preserves the ability to instantly navigate \"Back\".\r\n\t\t\t\t\t\t// Once a regular navigation takes place\r\n\t\t\t\t\t\t// all previous \"instant back\" possibilities are discarded.\r\n\t\t\t\t\t\tresetInstantNavigationChain()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Set the flag for `isInstantBackAbleNavigation()`.\r\n\t\t\t\t\t// `instantBack` is for a \"forward\" instant-back-able navigation.\r\n\t\t\t\t\t// `_isInstantTransition` is for a \"backwards\" instant-back-able navigation.\r\n\t\t\t\t\tif (instantBack || _isInstantTransition) {\r\n\t\t\t\t\t\twindow._ReactPages_Page_NavigationIsInstantBack = true\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// When `UPDATE_MATCH` event is triggered, navigation starts.\r\n\t\t\t\t\t// When `RESOLVE_MATCH` event is triggered, navigation ends.\r\n\t\t\t\t\t// `RESOLVE_MATCH` event is triggered after `UPDATE_MATCH` event.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// Trigger navigation start listeners.\r\n\t\t\t\t\tif (window._ReactPages_Navigation_Start_Listeners) {\r\n\t\t\t\t\t\tfor (const navigationStartListener of window._ReactPages_Navigation_Start_Listeners) {\r\n\t\t\t\t\t\t\tnavigationStartListener()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// // `RESOLVE_MATCH` is not being emitted\r\n\t\t\t\t\t// // for the first render for some reason.\r\n\t\t\t\t\t// // https://github.com/4Catalyzer/found/issues/202\r\n\t\t\t\t\t// const isFirstRender = !previousLocation\r\n\t\t\t\t\t// if (isFirstRender) {\r\n\t\t\t\t\t// \tupdateMetaTags(\r\n\t\t\t\t\t// \t\trouteIndices,\r\n\t\t\t\t\t// \t\tgetState(),\r\n\t\t\t\t\t// \t\t{\r\n\t\t\t\t\t// \t\t\troutes,\r\n\t\t\t\t\t// \t\t\tcodeSplit,\r\n\t\t\t\t\t// \t\t\tdefaultMeta: getDefaultMeta(defaultMeta, { getState })\r\n\t\t\t\t\t// \t\t}\r\n\t\t\t\t\t// \t)\r\n\t\t\t\t\t// } else {\r\n\t\t\t\t\t// \t// Show page loading indicator.\r\n\t\t\t\t\t// \tdispatch({ type: PRELOAD_STARTED })\r\n\t\t\t\t\t// }\r\n\r\n\t\t\t\t\tif (onBeforeNavigate) {\r\n\t\t\t\t\t\tonBeforeNavigate({\r\n\t\t\t\t\t\t\tdispatch,\r\n\t\t\t\t\t\t\tgetState,\r\n\t\t\t\t\t\t\tlocation: event.payload.location,\r\n\t\t\t\t\t\t\tparams: event.payload.params\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Show page loading indicator.\r\n\t\t\t\t\tif (!isServerSidePreloaded() && !window._ReactPages_RouterHasFinishedInitialRender) {\r\n\t\t\t\t\t\t// Don't show page loading indicator\r\n\t\t\t\t\t\t// because it's already being shown manually.\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Show page loading indicator.\r\n\t\t\t\t\t\tdispatch({ type: PRELOAD_STARTED })\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak\r\n\r\n\t\t\t\t// `UPDATE_MATCH` event is triggered when navigation starts.\r\n\t\t\t\t// `RESOLVE_MATCH` event is triggered when navigation ends.\r\n\t\t\t\t//\r\n\t\t\t\t// `RESOLVE_MATCH` is not being dispatched\r\n\t\t\t\t// for the first render for some reason.\r\n\t\t\t\t// https://github.com/4Catalyzer/found/issues/202\r\n\t\t\t\t// With server-side rendering enabled\r\n\t\t\t\t// initially there are two rendering passes\r\n\t\t\t\t// and therefore `RESOLVE_MATCH` does get dispatched\r\n\t\t\t\t// after the page is initialized and rendered.\r\n\t\t\t\t// With server-side rendering disabled\r\n\t\t\t\t// `RESOLVE_MATCH` does not get dispatched\r\n\t\t\t\t// therefore a custom `_RESOLVE_MATCH` event is\r\n\t\t\t\t// dispatched manually.\r\n\t\t\t\tcase RESOLVE_MATCH:\r\n\t\t\t\tcase _RESOLVE_MATCH:\r\n\t\t\t\t\tif (window._ReactPages_Navigation_IgnoreResolveMatchEvent) {\r\n\t\t\t\t\t\twindow._ReactPages_Navigation_IgnoreResolveMatchEvent = undefined\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// A workaround for `found` router bug:\r\n\t\t\t\t\t// https://github.com/4Catalyzer/found/issues/239\r\n\t\t\t\t\t// Skip `load` and other stuff for anchor link navigation.\r\n\t\t\t\t\tif (previousLocation && shouldSkipPreloadForNavigation(previousLocation, location)) {\r\n\t\t\t\t\t\t// I guess this workaround won't work with `codeSplit: true`\r\n\t\t\t\t\t\t// because it doesn't use the global `getData` loader.\r\n\t\t\t\t\t\tif (!codeSplit) {\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// `routeIndices` might be `undefined` after a `<Redirect/>`\r\n\t\t\t\t\t// is made and a user clicks the \"Back\" button in a web browser.\r\n\t\t\t\t\t// https://github.com/4Catalyzer/found/issues/632\r\n\t\t\t\t\tif (!routeIndices) {\r\n\t\t\t\t\t\tthrow new Error(`\"${event.type}\" Redux action misses \"routeIndices\" property. This usually means that the target URL path \"${location.pathname}\" didn't match any route. ${location.pathname[0] !== '/' ? 'The target URL path is missing a leading slash: correct your routes configuration to include a leading slash for \"' + location.pathname + '\" path. ' : ''}See the issue for more info: https://github.com/4Catalyzer/found/issues/632`)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// `previousLocation` is only used for \"instant back\" navigation.\r\n\t\t\t\t\t// Therefore it can be skipped in case of anchor link navigation.\r\n\t\t\t\t\tpreviousLocation = location\r\n\t\t\t\t\tpreviousRouteIndices = routeIndices\r\n\r\n\t\t\t\t\tif (!window._ReactPages_RouterHasFinishedInitialRender) {\r\n\t\t\t\t\t\twindow._ReactPages_RouterHasFinishedInitialRender = true\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Call `onLoaded`.\r\n\t\t\t\t\tif (!codeSplit) {\r\n\t\t\t\t\t\tconst routeChain = getRoutesByPath(routeIndices, routes)\r\n\t\t\t\t\t\tconst pageRoute = routeChain[routeChain.length - 1]\r\n\t\t\t\t\t\t// Routes don't have `.Component` property\r\n\t\t\t\t\t\t// set when using `codeSplit` feature.\r\n\t\t\t\t\t\tconst onPageLoaded = pageRoute.Component[ON_PAGE_LOADED_METHOD_NAME]\r\n\t\t\t\t\t\tif (onPageLoaded) {\r\n\t\t\t\t\t\t\tonPageLoaded({ dispatch, getState, location })\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Update `<meta/>`.\r\n\t\t\t\t\tupdateMetaTags(\r\n\t\t\t\t\t\trouteIndices,\r\n\t\t\t\t\t\tgetState(),\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\troutes,\r\n\t\t\t\t\t\t\tcodeSplit,\r\n\t\t\t\t\t\t\tdefaultMeta: getDefaultMeta(defaultMeta, { getState })\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)\r\n\r\n\t\t\t\t\tif (onNavigate) {\r\n\t\t\t\t\t\tonNavigate(getLocationUrl(location), location, {\r\n\t\t\t\t\t\t\tdispatch,\r\n\t\t\t\t\t\t\tgetState\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// When `UPDATE_MATCH` event is triggered, navigation starts.\r\n\t\t\t\t\t// When `RESOLVE_MATCH` event is triggered, navigation ends.\r\n\t\t\t\t\t// `RESOLVE_MATCH` event is triggered after `UPDATE_MATCH` event.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// Trigger navigation end listeners.\r\n\t\t\t\t\tif (window._ReactPages_Navigation_End_Listeners) {\r\n\t\t\t\t\t\tfor (const navigationEndListener of window._ReactPages_Navigation_End_Listeners) {\r\n\t\t\t\t\t\t\tnavigationEndListener()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// Reset the flag for `isInstantBackAbleNavigation()`.\r\n\t\t\t\t\twindow._ReactPages_Page_NavigationIsInstantBack = undefined\r\n\r\n\t\t\t\t\t// Report page loading time.\r\n\t\t\t\t\t// This loading time will be longer then\r\n\t\t\t\t\t// the server-side one, say, by 10 milliseconds,\r\n\t\t\t\t\t// probably because the web browser making\r\n\t\t\t\t\t// an asynchronous HTTP request is slower\r\n\t\t\t\t\t// than the Node.js server making a regular HTTP request.\r\n\t\t\t\t\t// Also this includes network latency\r\n\t\t\t\t\t// for a particular website user, etc.\r\n\t\t\t\t\t// So this `load` time doesn't actually describe\r\n\t\t\t\t\t// the server-side performance.\r\n\t\t\t\t\tif (reportStats) {\r\n\t\t\t\t\t\treportStats({\r\n\t\t\t\t\t\t\turl: getLocationUrl(location),\r\n\t\t\t\t\t\t\t// Concatenated route `path` string.\r\n\t\t\t\t\t\t\t// E.g. \"/user/:user_id/post/:post_id\"\r\n\t\t\t\t\t\t\troute: getRoutePath(getRoutesByPath(routeIndices, routes)),\r\n\t\t\t\t\t\t\ttime: {\r\n\t\t\t\t\t\t\t\tloadAndRender: Date.now() - startedAt\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Hide page loading indicator.\r\n\t\t\t\t\tdispatch({ type: PRELOAD_FINISHED })\r\n\r\n\t\t\t\t\t// Report loading time in console for debugging.\r\n\t\t\t\t\tif (Date.now() - startedAt > 30) {\r\n\t\t\t\t\t\tconsole.log(`[react-pages] \"${location.pathname}\" loaded and rendered in ${Date.now() - startedAt} ms`)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\r\n\t\t\treturn next(event)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction updateMetaTags(routeIndices, state, { routes, codeSplit, defaultMeta }) {\r\n\tconst routeChain = getRoutesByPath(routeIndices, routes)\r\n\t// Get `<meta/>` for the route.\r\n\tlet meta = codeSplit ? getCodeSplitMeta(routeChain, state) : getComponentsMeta(routeChain.map(_ => _.Component), state)\r\n\tmeta = mergeMeta(meta)\r\n\tmeta = { ...defaultMeta, ...meta }\r\n\t// Update `<meta/>`.\r\n\tupdateMeta(meta)\r\n}"],"mappings":"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"}