{"version":3,"file":"render.js","names":["renderOnServer","store","codeSplit","getDefaultMeta","time","preloadTimer","timer","matchRoutes","renderArgs","RedirectException","redirect","location","load","routes","elements","meta","getCodeSplitMeta","getState","getComponentsMeta","filter","_","map","type","mergeMeta","route","getRoutePath","status","getHttpResponseStatusCodeForTheRoute","content","createRouterElement","containerProps","matchedRoutes","reduce","previous","current"],"sources":["../../../lib/redux/server/render.js"],"sourcesContent":["import React from 'react'\r\n\r\nimport timer from '../../timer.js'\r\nimport { mergeMeta, getComponentsMeta, getCodeSplitMeta } from '../../meta/meta.js'\r\nimport { matchRoutes, RedirectException } from '../../router/index.js'\r\nimport getRoutePath from '../../router/getRoutePath.js'\r\nimport createRouterElement from '../../router/server/createRouterElement.js'\r\n\r\n// Returns a Promise resolving to { status, content, redirect }.\r\n//\r\nexport default async function renderOnServer({\r\n\tstore,\r\n\t// routes,\r\n\tcodeSplit,\r\n\tgetDefaultMeta\r\n}) {\r\n\t// Routing only takes a couple of milliseconds\r\n\t// const routingTimer = timer()\r\n\r\n\t// Profiling\r\n\tconst time = {}\r\n\r\n\tconst preloadTimer = timer()\r\n\r\n\tlet renderArgs\r\n\ttry {\r\n\t\trenderArgs = await matchRoutes(store)\r\n\t} catch (error) {\r\n\t\t// Catches redirects from `load`s,\r\n\t\t// redirects from `onError` and from `<Redirect/>` routes.\r\n\t\tif (error instanceof RedirectException) {\r\n\t\t\treturn {\r\n\t\t\t\tredirect: error.location\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow error\r\n\t}\r\n\r\n\ttime.load = preloadTimer()\r\n\r\n\t// Gather `<title/>` and `<meta/>` tags for this route path\r\n\tconst { routes, elements } = renderArgs\r\n\r\n\t// Get `<meta/>` for the route.\r\n\tlet meta = codeSplit ? getCodeSplitMeta(routes, store.getState()) : getComponentsMeta(elements.filter(_ => _).map(_ => _.type), store.getState())\r\n\tmeta = mergeMeta(meta)\r\n\tmeta = { ...getDefaultMeta(), ...meta }\r\n\r\n\t// Return HTTP status code and the rendered page\r\n\treturn {\r\n\t\t// Concatenated route `path` string.\r\n\t\t// E.g. \"/user/:userId/post/:postId\"\r\n\t\troute   : getRoutePath(routes),\r\n\t\tstatus  : getHttpResponseStatusCodeForTheRoute(routes),\r\n\t\tcontent : createRouterElement(renderArgs),\r\n\t\tmeta,\r\n\t\tcontainerProps : { store },\r\n\t\ttime\r\n\t}\r\n}\r\n\r\n// One can set a `status` prop for a route\r\n// to be returned as an Http response status code (404, etc)\r\nfunction getHttpResponseStatusCodeForTheRoute(matchedRoutes)\r\n{\r\n\treturn matchedRoutes.reduce((previous, current) => (current && current.status) || (previous && current.status), null)\r\n}"],"mappings":";;;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AAA4E;AAAA;AAAA,+CAL5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AAAA,SAC8BA,cAAc;EAAA;AAAA,EAmD5C;AACA;AAAA;EAAA,6EApDe;IAAA;IAAA;MAAA;QAAA;UACdC,KAAK,QAALA,KAAK,EAELC,SAAS,QAATA,SAAS,EACTC,cAAc,QAAdA,cAAc;UAEd;UACA;UAEA;UACMC,IAAI,GAAG,CAAC,CAAC;UAETC,YAAY,GAAG,IAAAC,iBAAK,GAAE;UAAA;UAAA;UAAA,OAIR,IAAAC,kBAAW,EAACN,KAAK,CAAC;QAAA;UAArCO,UAAU;UAAA;UAAA;QAAA;UAAA;UAAA;UAAA,MAIN,uBAAiBC,wBAAiB;YAAA;YAAA;UAAA;UAAA,iCAC9B;YACNC,QAAQ,EAAE,YAAMC;UACjB,CAAC;QAAA;UAAA;QAAA;UAKHP,IAAI,CAACQ,IAAI,GAAGP,YAAY,EAAE;;UAE1B;UAAA,cAC6BG,UAAU,EAA/BK,MAAM,eAANA,MAAM,EAAEC,QAAQ,eAARA,QAAQ,EAExB;UACIC,IAAI,GAAGb,SAAS,GAAG,IAAAc,sBAAgB,EAACH,MAAM,EAAEZ,KAAK,CAACgB,QAAQ,EAAE,CAAC,GAAG,IAAAC,uBAAiB,EAACJ,QAAQ,CAACK,MAAM,CAAC,UAAAC,CAAC;YAAA,OAAIA,CAAC;UAAA,EAAC,CAACC,GAAG,CAAC,UAAAD,CAAC;YAAA,OAAIA,CAAC,CAACE,IAAI;UAAA,EAAC,EAAErB,KAAK,CAACgB,QAAQ,EAAE,CAAC;UACjJF,IAAI,GAAG,IAAAQ,eAAS,EAACR,IAAI,CAAC;UACtBA,IAAI,mCAAQZ,cAAc,EAAE,GAAKY,IAAI,CAAE;;UAEvC;UAAA,iCACO;YACN;YACA;YACAS,KAAK,EAAK,IAAAC,wBAAY,EAACZ,MAAM,CAAC;YAC9Ba,MAAM,EAAIC,oCAAoC,CAACd,MAAM,CAAC;YACtDe,OAAO,EAAG,IAAAC,+BAAmB,EAACrB,UAAU,CAAC;YACzCO,IAAI,EAAJA,IAAI;YACJe,cAAc,EAAG;cAAE7B,KAAK,EAALA;YAAM,CAAC;YAC1BG,IAAI,EAAJA;UACD,CAAC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACD;EAAA;AAAA;AAID,SAASuB,oCAAoC,CAACI,aAAa,EAC3D;EACC,OAAOA,aAAa,CAACC,MAAM,CAAC,UAACC,QAAQ,EAAEC,OAAO;IAAA,OAAMA,OAAO,IAAIA,OAAO,CAACR,MAAM,IAAMO,QAAQ,IAAIC,OAAO,CAACR,MAAO;EAAA,GAAE,IAAI,CAAC;AACtH"}